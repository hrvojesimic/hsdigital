{"id":"covid-wave-1","title":"First wave of COVID cases in Europe","description":"First half of 2020 saw a wave of COVID cases crash across Europe. But different countries had very different waves.","lang":"en","image":"https://hrvoje.simic.digital/story/covid-wave-1/europe-offsets.png","published":{"year":2020,"month":"OCTOBER","monthValue":10,"dayOfMonth":26,"leapYear":true,"dayOfWeek":"MONDAY","dayOfYear":300,"era":"CE","chronology":{"id":"ISO","calendarType":"iso8601"}},"features":["d3-array","d3-selection-multi","topojson","customJS","vega","d3","customCSS"],"steps":[{"content":"<h1 id=\"first-wave-of-covid-cases-in-europe\" class=\"title\">First wave of COVID cases in Europe</h1>\n<p><em>Hrvoje Šimić, 2020-10-26</em></p>\n<p>If we plot COVID-19 daily reported cases and deaths from <a href=\"https://github.com/owid/covid-19-data/blob/master/public/data/ecdc\">ECDC</a> across all EU countries, we get this:</p>\n<figure style=\"max-width: 500px; margin: auto\">\n  <div class=\"covidChart\" data-show=\"cd\" data-territory=\"EU\" data-offset=\"0\" data-dmax=\"40\" data-window=\"1\"></div>\n  <figcaption>Plot of daily reported cases and deaths in all EU countries combined.</figcaption>\n</figure>\n<p>Let&#39;s take a simple symmetric 31-day average to get rid of the noise:</p>\n<figure style=\"max-width: 500px; margin: auto\">\n  <div class=\"covidChart\" data-show=\"cd\" data-territory=\"EU\" data-offset=\"0\" data-dmax=\"24\" data-window=\"31\"></div>\n  <figcaption>Plot of daily reported cases and deaths in EU, averaged across 31 days. Last 14 days are progressively faded as they are likely to change with future data.</figcaption>\n</figure>\n<p>It&#39;s easy to see that both registered cases and deaths from COVID came in &quot;waves&quot;, the first appearing in March and dying down by the end of June, and the second still rising.</p>\n\n<h2 id=\"identifying-the-first-wave-of-the-epidemic\" class=\"section\">Identifying the first wave of the epidemic</h2>\n<p>Does this wave of reported cases emerge in every European country? A systematic approach would be to formally define parameters of the first wave, the one that occurred in the first six months of 2020. On the 31-day average time series we are using these criteria:</p>\n<ul>\n  <li>wave <em>started</em> on the day that average exceeded one case per million population;</li>\n  <li>wave <em>peaked</em> on the day of highest value in those six months;</li>\n  <li>wave <em>ended</em> on the first day after peak day which either had under one case per million population, or minimum value between peak day and July 1<sup>st</sup>;</li>\n  <li>difference between end value and peak value divided by the peak value is <em>relative height</em> of the wave.</li>\n</ul>\n<p>These parameters are shown in the following chart. For each country, the span of the wave is depicted with a blue bar. The bar is darker as the relative height of the wave is larger, with the date of highest value marked with a red tick on the bar.</p>\n<pre class=\"vly exceptMob \" id=\"null\">{\"width\":280,\"height\":520,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"firstWaves\"},\"layer\":[{\"mark\":\"bar\",\"encoding\":{\"x\":{\"field\":\"startDate\",\"type\":\"temporal\",\"title\":null},\"x2\":{\"field\":\"lowDate\",\"type\":\"temporal\"},\"color\":{\"field\":\"relHeight\",\"type\":\"quantitative\",\"title\":\"wave height\"},\"y\":{\"field\":\"country\",\"type\":\"nominal\",\"title\":null,\"sort\":\"x\"},\"tooltip\":[{\"field\":\"country\",\"type\":\"nominal\"},{\"field\":\"startDate\",\"type\":\"temporal\"},{\"field\":\"peakDate\",\"type\":\"temporal\"},{\"field\":\"lowDate\",\"type\":\"temporal\"},{\"field\":\"relHeight\",\"type\":\"quantitative\",\"title\":\"relative wave height\"}]}},{\"mark\":{\"type\":\"tick\",\"stroke\":\"white\",\"fill\":\"red\"},\"encoding\":{\"x\":{\"field\":\"peakDate\",\"type\":\"temporal\"},\"y\":{\"field\":\"country\",\"type\":\"nominal\",\"sort\":\"x\"}}}],\"config\":{\"tick\":{\"thickness\":4}},\"caption\":\"Extent of first waves in select European countries.\",\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<pre class=\"vly onlyMob \" id=\"null\">{\"width\":160,\"height\":520,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"firstWaves\"},\"transform\":[{\"calculate\":\"slice(datum.country, 0, 10)\",\"as\":\"shortCountryName\"}],\"layer\":[{\"mark\":\"bar\",\"encoding\":{\"x\":{\"field\":\"startDate\",\"type\":\"temporal\",\"title\":null},\"x2\":{\"field\":\"lowDate\",\"type\":\"temporal\"},\"color\":{\"field\":\"relHeight\",\"type\":\"quantitative\",\"title\":\"wave height\"},\"y\":{\"field\":\"shortCountryName\",\"type\":\"nominal\",\"title\":null,\"sort\":\"x\"},\"tooltip\":[{\"field\":\"country\",\"type\":\"nominal\"},{\"field\":\"startDate\",\"type\":\"temporal\"},{\"field\":\"peakDate\",\"type\":\"temporal\"},{\"field\":\"lowDate\",\"type\":\"temporal\"},{\"field\":\"relHeight\",\"type\":\"quantitative\",\"title\":\"relative wave height\"}]}},{\"mark\":{\"type\":\"tick\",\"stroke\":\"white\",\"fill\":\"red\"},\"encoding\":{\"x\":{\"field\":\"peakDate\",\"type\":\"temporal\"},\"y\":{\"field\":\"shortCountryName\",\"type\":\"nominal\",\"sort\":\"x\"}}}],\"config\":{\"tick\":{\"thickness\":4},\"axisY\":{\"maxExtent\":20}},\"caption\":\"Extent of first waves in select European countries.\",\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<p>We can see that most countries satisfy these two conditions:</p>\n<ul>\n  <li>wave is pronounced (relative height greater than 80%) and</li>\n</ul>\n<ul>\n  <li>the peak has occurred before May 1<sup>st</sup>.</li>\n</ul>\n<p>However, there are some countries which do not have an observable distinct wave in the first half of the year. They are mostly located in the eastern part of the continent (notably including also Sweden), with Belarus and Poland as border cases.</p>\n\n<h2 id=\"correlation-between-cases-and-deaths\" class=\"section\">Correlation between cases and deaths</h2>\n<p>Now that we have an interval of COVID cases, let&#39;s see how the cases curve and the deaths curve correlate with one another. A rise and fall in cases should be followed by the corresponding change in the deaths curve, following the former by a undetermined offset, counted in days or perhaps weeks. This should correspond to real-world time shift between disease detection and recorded fatality. Clean-cut waves in epidemic are useful here, because we expect most cases to resolve either in recovery or death.</p>\n<p>We can calculate Pearson&#39;s correlation coefficient for offsets from zero to 28 days to estimate best fit between the curves. The correlation varies for different offsets:</p>\n<pre class=\"vly exceptMob \" id=\"null\">{\"width\":120,\"height\":120,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"waveCorrelations\"},\"transform\":[{\"filter\":\"datum.country == 'EU'\"},{\"filter\":{\"field\":\"w\",\"oneOf\":[0,3,15]}},{\"calculate\":\"if(datum.w == 0, 'no averaging', if(datum.w == 3, '7-day', '31-day'))\",\"as\":\"wtitle\"}],\"mark\":\"line\",\"encoding\":{\"column\":{\"field\":\"wtitle\",\"type\":\"ordinal\",\"title\":\"averaging window\",\"sort\":{\"field\":\"w\"}},\"x\":{\"field\":\"offset\",\"type\":\"quantitative\"},\"y\":{\"field\":\"r\",\"type\":\"quantitative\",\"title\":\"Pearson's r\"}},\"caption\":\"Correlation between daily cases and offset deaths (in days) for various rolling average windows.\",\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<pre class=\"vly onlyMob \" id=\"null\">{\"width\":150,\"height\":150,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"waveCorrelations\"},\"transform\":[{\"filter\":\"datum.country == 'EU'\"},{\"filter\":{\"field\":\"w\",\"oneOf\":[0,3,15]}},{\"calculate\":\"if(datum.w == 0, 'no averaging', if(datum.w == 3, '7-day', '31-day'))\",\"as\":\"wtitle\"}],\"mark\":\"line\",\"encoding\":{\"row\":{\"field\":\"wtitle\",\"type\":\"ordinal\",\"title\":\"averaging window\",\"sort\":{\"field\":\"w\"}},\"x\":{\"field\":\"offset\",\"type\":\"quantitative\"},\"y\":{\"field\":\"r\",\"type\":\"quantitative\",\"title\":\"Pearson's r\"}},\"caption\":\"Correlation between daily cases and offset deaths (in days) for various rolling average windows.\",\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<p>When there is no averaging you can notice small waves that are there because of the weekly variation of data. These disappear when we calculate simple 7-day rolling average.</p>\n<p>31-day window rolling average is quite similar to 7-day. The correlation coefficient is somewhat higher because some of the noise gets averaged out.</p>\n<p>Peak correlation appears to be for offset around 7 days, and this is true regardless of averaging.</p>\n<p>From this we can conclude there is a &quot;sweet spot&quot; where the curves for EU&#39;s cases and deaths in the first wave overlap very well, as <em>r</em> ≈ 1. But how does this look on the country level?</p>\n\n<h2 id=\"case-death-curve-correlations-in-different-countries\" class=\"section\">Case/death curve correlations in different countries</h2>\n<p>Here we have charts that show correlation as function of offset for different averaging windows, from 1 (no averaging) to full 31 days.</p>\n<p>The most populous countries in EU do show a similar pattern:</p>\n<pre class=\"vly exceptMob \" id=\"null\">{\"width\":120,\"height\":120,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"waveCorrelations\"},\"transform\":[{\"filter\":{\"field\":\"country\",\"oneOf\":[\"Germany\",\"France\",\"Italy\",\"Spain\"]}},{\"calculate\":\"datum.w * 2 + 1\",\"as\":\"days averaged\"}],\"mark\":\"line\",\"encoding\":{\"column\":{\"field\":\"country\",\"type\":\"nominal\",\"title\":null},\"x\":{\"field\":\"offset\",\"type\":\"quantitative\"},\"color\":{\"field\":\"days averaged\",\"type\":\"ordinal\"},\"y\":{\"field\":\"r\",\"type\":\"quantitative\",\"title\":\"Pearson's r\"}},\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<pre class=\"vly onlyMob \" id=\"null\">{\"width\":150,\"height\":150,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"waveCorrelations\"},\"transform\":[{\"filter\":{\"field\":\"country\",\"oneOf\":[\"Germany\",\"France\",\"Italy\",\"Spain\"]}},{\"calculate\":\"datum.w * 2 + 1\",\"as\":\"days averaged\"}],\"mark\":\"line\",\"encoding\":{\"row\":{\"field\":\"country\",\"type\":\"nominal\",\"title\":null},\"x\":{\"field\":\"offset\",\"type\":\"quantitative\"},\"color\":{\"field\":\"days averaged\",\"type\":\"ordinal\"},\"y\":{\"field\":\"r\",\"type\":\"quantitative\",\"title\":\"Pearson's r\"}},\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<p>However, they widely vary in peak-correlation offset: Italy peaks at just 4 days, while Germany peaks at full 14 days deaths curve offset.</p>\n<p>Most smaller countries are showing this pattern too:</p>\n<pre class=\"vly exceptMob \" id=\"null\">{\"width\":120,\"height\":120,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"waveCorrelations\"},\"transform\":[{\"filter\":{\"field\":\"country\",\"oneOf\":[\"Austria\",\"Belgium\",\"Norway\",\"Switzerland\"]}},{\"calculate\":\"datum.w * 2 + 1\",\"as\":\"days averaged\"}],\"mark\":\"line\",\"encoding\":{\"column\":{\"field\":\"country\",\"type\":\"nominal\",\"title\":null},\"x\":{\"field\":\"offset\",\"type\":\"quantitative\"},\"color\":{\"field\":\"days averaged\",\"type\":\"ordinal\"},\"y\":{\"field\":\"r\",\"type\":\"quantitative\",\"title\":\"Pearson's r\"}},\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<pre class=\"vly onlyMob \" id=\"null\">{\"width\":150,\"height\":150,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"waveCorrelations\"},\"transform\":[{\"filter\":{\"field\":\"country\",\"oneOf\":[\"Austria\",\"Belgium\",\"Norway\",\"Switzerland\"]}},{\"calculate\":\"datum.w * 2 + 1\",\"as\":\"days averaged\"}],\"mark\":\"line\",\"encoding\":{\"row\":{\"field\":\"country\",\"type\":\"nominal\",\"title\":null},\"x\":{\"field\":\"offset\",\"type\":\"quantitative\"},\"color\":{\"field\":\"days averaged\",\"type\":\"ordinal\"},\"y\":{\"field\":\"r\",\"type\":\"quantitative\",\"title\":\"Pearson's r\"}},\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<p>Belgium is similar to Italy, while Austria, Norway and Switzerland are like Germany, hovering around 14 days.</p>\n<p>A few countries do have a recognizable first wave, but without a sizable offset between the curves.</p>\n<pre class=\"vly exceptMob \" id=\"null\">{\"width\":120,\"height\":120,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"waveCorrelations\"},\"transform\":[{\"filter\":{\"field\":\"country\",\"oneOf\":[\"Serbia\",\"United Kingdom\",\"Denmark\"]}},{\"calculate\":\"datum.w * 2 + 1\",\"as\":\"days averaged\"}],\"mark\":{\"type\":\"line\",\"clip\":true},\"encoding\":{\"column\":{\"field\":\"country\",\"type\":\"nominal\",\"title\":null},\"x\":{\"field\":\"offset\",\"type\":\"quantitative\"},\"color\":{\"field\":\"days averaged\",\"type\":\"ordinal\"},\"y\":{\"field\":\"r\",\"type\":\"quantitative\",\"title\":\"Pearson's r\",\"scale\":{\"domain\":[0,1]}}},\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<pre class=\"vly onlyMob \" id=\"null\">{\"width\":150,\"height\":150,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"waveCorrelations\"},\"transform\":[{\"filter\":{\"field\":\"country\",\"oneOf\":[\"Serbia\",\"United Kingdom\",\"Denmark\"]}},{\"calculate\":\"datum.w * 2 + 1\",\"as\":\"days averaged\"}],\"mark\":{\"type\":\"line\",\"clip\":true},\"encoding\":{\"row\":{\"field\":\"country\",\"type\":\"nominal\",\"title\":null},\"x\":{\"field\":\"offset\",\"type\":\"quantitative\"},\"color\":{\"field\":\"days averaged\",\"type\":\"ordinal\"},\"y\":{\"field\":\"r\",\"type\":\"quantitative\",\"title\":\"Pearson's r\",\"scale\":{\"domain\":[0,1]}}},\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<p>Serbia here is instructive, as it shows some correlation around 12 days in the no averaging condition, but this fades out with wider averaging windows. United Kingdom&#39;s peak correlation is stuck at zero, suggesting very late testing or post-mortem testing in the course of disease in the initial phase of the epidemic.</p>\n<p>Off the deep end are countries that had no defined wave in the first half of 2020:</p>\n<pre class=\"vly exceptMob \" id=\"null\">{\"width\":120,\"height\":120,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"waveCorrelations\"},\"transform\":[{\"filter\":{\"field\":\"country\",\"oneOf\":[\"Belarus\",\"Sweden\",\"Poland\"]}},{\"calculate\":\"datum.w * 2 + 1\",\"as\":\"days averaged\"}],\"mark\":{\"type\":\"line\",\"clip\":true},\"encoding\":{\"column\":{\"field\":\"country\",\"type\":\"nominal\",\"title\":null},\"x\":{\"field\":\"offset\",\"type\":\"quantitative\"},\"color\":{\"field\":\"days averaged\",\"type\":\"ordinal\"},\"y\":{\"field\":\"r\",\"type\":\"quantitative\",\"title\":\"Pearson's r\",\"scale\":{\"domain\":[0,1]}}},\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<pre class=\"vly onlyMob \" id=\"null\">{\"width\":150,\"height\":150,\"autosize\":{\"resize\":true},\"data\":{\"name\":\"waveCorrelations\"},\"transform\":[{\"filter\":{\"field\":\"country\",\"oneOf\":[\"Belarus\",\"Sweden\",\"Poland\"]}},{\"calculate\":\"datum.w * 2 + 1\",\"as\":\"days averaged\"}],\"mark\":{\"type\":\"line\",\"clip\":true},\"encoding\":{\"row\":{\"field\":\"country\",\"type\":\"nominal\",\"title\":null},\"x\":{\"field\":\"offset\",\"type\":\"quantitative\"},\"color\":{\"field\":\"days averaged\",\"type\":\"ordinal\"},\"y\":{\"field\":\"r\",\"type\":\"quantitative\",\"title\":\"Pearson's r\",\"scale\":{\"domain\":[0,1]}}},\"$schema\":\"https://vega.github.io/schema/vega-lite/v4.json\"}</pre>\n<p>What these cases suggest is that <em>when there is no distinct &quot;wave&quot; of cases, there is no significant correlation between cases and deaths</em> in the conditions we have explored. Averaging raises correlation coefficients, but they don&#39;t converge to specific value.</p>\n\n<h2 id=\"the-offset-map\" class=\"section\">The offset map</h2>\n<p>We can show differences in best-fit offsets between countries on the map of Europe. Here, countries are colored according to the size of offset between deaths and cases. The larger the offset, the darker the color: white means zero offset or no distinct wave in first half of 2020. Offset with peak correlation coefficient are shown in circles, and the circle is darker as the peak correlation is higher.</p>\n<figure style=\"max-width: 500px; margin: auto\">\n  <div id=\"OffsetMap\">Loading map...</div>\n  <figcaption>\n    Map of Europe showing first-wave death curve offsets (in circles). Darker red color corresponds to larger offset and darker circle corresponds to higher value of <i>r</i>. White countries without circles have no distinct wave.\n  </figcaption>\n</figure>\n<p>Differences are striking, but the map is not in chaos. There are noticeable geographical patterns:</p>\n<ul>\n  <li>Eastern Europe mostly lacks distinct first wave. They were late to the &quot;Corona party&quot;, had low incidence all through spring and summer, but the number of cases was still relatively high in the summer months.</li>\n  <li>Central Europe countries mostly have well-defined first wave curves, with offset at around two weeks. Norway and Iceland follow suit, while Denmark doesn&#39;t, and Sweden is an obvious black sheep in the European flock thanks to its epidemiology policies.</li>\n  <li>Baltic countries have rather small number of cases and this is possible reason of disparate offsets and correlation coefficients. However, if we combine data from Estonia, Lithuania, and Latvia, we get a regular chart and an offset of 12 days, consistent with Central Europe.</li>\n  <li>Western Europe is quite consistent with one week offset. UK is outlier here, again choosing a different approach in the early days of the epidemic.</li>\n  <li>Italy has quite short offset, perhaps not surprising given the dramatic start of the first wave there.</li>\n</ul>\n<p>There could be multiple reasons behind these differences, from statistical practices to administrative procedures, from age distributions of patients to differences in treatment. Causes and repercussions of this effect are left to explore in future articles, coming soon.</p>","form":"html"}],"headings":[{"id":"identifying-the-first-wave-of-the-epidemic","title":"Identifying the first wave of the epidemic"},{"id":"correlation-between-cases-and-deaths","title":"Correlation between cases and deaths"},{"id":"case-death-curve-correlations-in-different-countries","title":"Case/death curve correlations in different countries"},{"id":"the-offset-map","title":"The offset map"}]}